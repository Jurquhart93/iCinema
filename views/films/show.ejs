<% layout('layouts/boilerplate') %>
    <link rel="stylesheet" href="/css/stars.css">

    <header class="heading">
        <h1 class="heading-h1">
            <%= film.title %>
        </h1>
    </header>
    <section class="film">
        <section class="film-info">
            <img src="<%= film.image.url %>" alt="<%= film.image.title %> cover photo" class="film-info-img">
            <div class="film-info-data">
                <p>
                    <%= film.rating %>
                </p>
                <p>
                    <%= film.runtime %>
                </p>
                <p>
                    <%= film.releasedate %>
                </p>
                <p>
                    <%= film.genre %>
                </p>
                <!-- <p>Stock: <%= film.stock %>
                </p> -->
            </div>
            <div class="film-info-desc">
                <p>
                    <%= film.description %> Lorem ipsum dolor sit amet consectetur adipisicing elit. Assumenda omnis
                        officia impedit numquam, esse neque in non a doloribus labore aperiam autem maiores ducimus
                        dolorem magni id tenetur. Possimus, tempora. Lorem, ipsum dolor sit amet consectetur adipisicing
                        elit. Soluta quibusdam eius deserunt unde dolorem commodi, pariatur a animi possimus,
                        necessitatibus expedita minus perferendis ab porro. Molestias perspiciatis magni voluptate
                        aliquam.
                </p>
                <p>
                    <%= film.stock %>
                </p>
            </div>
        </section>

        <section class="film-booking">
            <h3 class="film-booking-heading">
                Ticket Bookings
            </h3>
            <form action="/films/<%= film.titleSlug %>" method="POST" class="film-booking-form">
                <!-- <label for="booking" class="form-label">Quantity</label> -->
                <div class="film-booking-container">
                    <div onclick="decreaseValue()"><span>-</span></div>
                    <div id="ticketCountView">0</div>
                    <input type="hidden" id="ticketCount" name="quantity" value="0">
                    <div onclick="increaseValue()"><span>+</span></div>
                </div>
                <button class="film-booking-btn">Book Now</button>
            </form>
        </section>

        <section class="film-reviews">
            <div class="film-reviews-review">
                <h3 class="film-reviews-h3">Reviews
                    <% if(!film.reviews.length){ %>
                        <span>Currently no reviews to show.</span>
                        <% } %>
                </h3>
                <% for(let review of film.reviews){ %>
                    <div class="film-reviews-review-container">
                        <div class="film-reviews-review-author">
                            <p>
                                Review by <%= review.author.username %>
                            </p>
                            <p class="starability-result" data-rating="<%=review.rating%>">
                                Rated: <%=review.rating%> stars
                            </p>
                        </div>

                        <div class="film-reviews-review-body">
                            <p>
                                <%= review.body %>
                            </p>
                        </div>

                        <form action="/films/<%= film.titleSlug %>/reviews/<%= review._id %>?_method=DELETE"
                            method="POST">
                            <% if (currentUser && review.author.equals(currentUser._id)) { %>
                                <button>Delete</button>
                                <% } %>
                        </form>
                    </div>
                    <% } %>
            </div>
            <div class="film-reviews-form">

                <h3 class="film-reviews-h3">Leave a review
                    <% if(!currentUser){ %>
                        <span>Please sign in to leave a review! </span>
                        <% } %>
                </h3>
                <% if(currentUser){ %>

                    <form action="/films/<%= film.titleSlug %>/reviews" method="POST" class="validate-form" novalidate>
                        <div>
                            <fieldset class="starability-basic">
                                <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1"
                                    checked aria-label="No rating." />
                                <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                                <label for="first-rate1" title="Terrible">1 star</label>
                                <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                                <label for="first-rate2" title="Not good">2 stars</label>
                                <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                                <label for="first-rate3" title="Average">3 stars</label>
                                <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                                <label for="first-rate4" title="Very good">4 stars</label>
                                <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                                <label for="first-rate5" title="Amazing">5 stars</label>
                            </fieldset>
                        </div>
                        <div>
                            <label for="body">Review</label>
                            <textarea name="review[body]" id="body" class="form-control" cols="30" rows="3"
                                minlength="1" maxlength="1000" required></textarea>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                        </div>

                        <button>Add Review</button>
                    </form>
            </div>
            <% } %>

        </section>
    </section>

    <script>
        function increaseValue() {
            let value = parseInt(document.getElementById('ticketCount').value, 10);
            value = isNaN(value) ? 0 : value;
            value++;
            document.getElementById('ticketCountView').innerHTML = value;
            document.getElementById('ticketCount').value = value;
        }

        function decreaseValue() {
            let value = parseInt(document.getElementById('ticketCount').value, 10);
            value = isNaN(value) ? 0 : value;
            value < 1 ? value = 0 : value--;
            document.getElementById('ticketCountView').innerHTML = value;
            document.getElementById('ticketCount').value = value
        }
    </script>